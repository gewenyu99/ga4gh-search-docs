<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../../../../css/style.css">
    <link rel="stylesheet" type="text/css" href="../../../../css/page-layouts/content-header.css">
    <link rel="stylesheet" type="text/css" href="../../../../css/sidebar/style.css">
    <link rel="stylesheet" type="text/css" href="../../../../css/page-layouts/style.css">
    <link rel="stylesheet" type="text/css" href="../../../../css/page-layouts/syntax.css">
    <link rel="stylesheet" type="text/css" href="../../../../css/tabs/style.css">
    <link rel="stylesheet" type="text/css" href="../../../../css/bootstrap.min.css">
    
    <link rel="stylesheet" href="../../../../override/style.css">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Source Code Pro">

    <!-- feather-icon -->
    <link rel="stylesheet" href="../../../../feather-icons/css/iconfont.css">
  
    <!--Favicon-->
    <link rel="icon" href="../../../../images/favicon.png" type="image/x-icon">

    
    <style>
        :root {
            --white: #ffffff;
            --primary: #fff;
            --secondary: #1E1F21;
            --sidebar: #9062a5;
            --accent: #8cc63e;
            --grey200: #F9F9FA;
            --grey600: #969DAC;
            --grey-head: #EFEFF3;
            --nav-highlight: ;
        }
    </style>
    
    <title>GA4GH Discovery Search API | Consume Data</title>
</head><body><div class="sidebar" id="sidebar-nav">
    
<button id="logo-collapse-btn" onclick="(function(){document.getElementById('sidebar-nav').classList.toggle('show');document.getElementById('content').classList.toggle('showing-nav')})()" >
        <h3 id="title">GA4GH Discovery Search API</h3>
    </button>

    




<div class="card sidebar-card">

    <div class="collapse-header">
        <a class="nav-link" href="../../../../docs/getting-started/"> 
            <i class="icon-layers navicon"></i>
            <h3 class="sidebar-h1  mainitem" 
            id="">
                Quick Start
            </h3>
        </a>
    </div>
    
    <div class="collapse show">
        <div class="nav-list">
            
                <a class="nav-link" href="../../../../docs/getting-started/intro/doc/"> 
                    <h3 class="sidebar-h2  subitem" 
                    id="">
                        Introduction
                    </h3>
                </a>
            
                <a class="nav-link" href="../../../../docs/getting-started/provision-data/doc/"> 
                    <h3 class="sidebar-h2  subitem" 
                    id="">
                        Provision Data
                    </h3>
                </a>
            
                <a class="nav-link" href="../../../../docs/getting-started/consume-data/doc/"> 
                    <h3 class="sidebar-h2 nav-highlight subitem" 
                    id="scrollto">
                        Consume Data
                    </h3>
                </a>
            
                <a class="nav-link" href="../../../../docs/getting-started/upload-results/doc/"> 
                    <h3 class="sidebar-h2  subitem" 
                    id="">
                        Upload results
                    </h3>
                </a>
                            
        </div>
    </div>

    <div class="collapse-header">
        <a class="nav-link" href="../../../../docs/use-exisitng-data/"> 
            <i class="icon-database navicon"></i>
            <h3 class="sidebar-h1  mainitem" 
            id="">
                Use Existing Data
            </h3>
        </a>
    </div>
    
    <div class="collapse ">
        <div class="nav-list">
            
                <a class="nav-link" href="../../../../docs/use-exisitng-data/retrofit-a-data-explorer/doc/"> 
                    <h3 class="sidebar-h2  subitem" 
                    id="">
                        Retrofit data explorers
                    </h3>
                </a>
            
                <a class="nav-link" href="../../../../docs/use-exisitng-data/tables-in-a-bucket/doc/"> 
                    <h3 class="sidebar-h2  subitem" 
                    id="">
                        Tables-in-a-bucket
                    </h3>
                </a>
            
                <a class="nav-link" href="../../../../docs/use-exisitng-data/using-preso/doc/"> 
                    <h3 class="sidebar-h2  subitem" 
                    id="">
                        Using Presto
                    </h3>
                </a>
                            
        </div>
    </div>

    <div class="collapse-header">
        <a class="nav-link" href="../../../../docs/security/"> 
            <i class="icon-shield navicon"></i>
            <h3 class="sidebar-h1  mainitem" 
            id="">
                Security
            </h3>
        </a>
    </div>
    
    <div class="collapse ">
        <div class="nav-list">
            
                <a class="nav-link" href="../../../../docs/security/data-source/doc/"> 
                    <h3 class="sidebar-h2  subitem" 
                    id="">
                        At the data source
                    </h3>
                </a>
            
                <a class="nav-link" href="../../../../docs/security/search-endpoint/doc/"> 
                    <h3 class="sidebar-h2  subitem" 
                    id="">
                        At the search endpoint
                    </h3>
                </a>
                            
        </div>
    </div>

</div>

</div>

<div class="content" id="content"><div class="content-header">
    <div id="search-input-div">
        

        <button class="search-button" id="search-button" data-toggle="modal" data-target="#search-input-modal" onclick='setFocusToTextBox()'>
            <h3 class="search-button-text">
                <i class="icon-search search-icon"></i>
                Find anything
            </h3>
        </button>
    
        <div class="modal search" id="search-input-modal">
            <div id="search-input-modal" class="modal-dialog">
                <div id="search-input-div" class="modal-content">
                    <input id="search-input" type="text" placeholder="" name="search" autocomplete="off">
                    <span class="focus-border"></span>
                    <section id="search-results" class="search"></section>
                </div>
            </div>
        </div>

        
    </div>
    
</div>
<div class="text-area">
<h2>Consume Data</h2>





    





    
    <div class="row">
        <div class="content-area">
            <p class="boxtext"></p>
<h4 id="queries">Queries</h4>
<p>The Search API supports query operation through SQL statements.</p>
<p>The GA4GH Search APIâ€™s SQL dialect has been selected for compatibility with current major open source database platforms including Presto SQL, PostgreSQL, and MySQL, as well as BigQuery. There are occasional name or signature differences, but a GA4GH Search API implementation atop any of the major database platforms should be able to pass through queries that use the functions listed below with only minor tweaks.</p>
<p>Details of the supported SQL functions can be found here: <a href="https://github.com/ga4gh-discovery/ga4gh-search/blob/develop/SEARCHSPEC.md#sql-functions">SQL functions</a></p>
<p>Details of the supported SQL grammar can be found here: <a href="https://github.com/ga4gh-discovery/ga4gh-search/blob/develop/SEARCHSPEC.md#appendix-a-sql-grammar">SQL grammar</a></p>
<p></p>
        </div>
        <div class="example-area">
            <div class="example">
        
<nav>
	<div class="nav nav-tabs tabs-head" role="tablist">

		
		

		
		
		

		

		<a class="nav-item nav-link content-tab active" id="nav-1" data-toggle="tab" href="#tab11" role="tab"
		   aria-controls="nav-home" aria-selected="true">Example #1</a>

		
		

		
		
		

		

		<a class="nav-item nav-link content-tab" id="nav-1" data-toggle="tab" href="#tab12" role="tab"
		   aria-controls="nav-home" aria-selected="false">Example #2</a>

		
		

	</div>
</nav>

<div class="tab-content scroll" id="1">









<div class="tab-pane fade show active" id="tab11" role="tabpanel" aria-labelledby="nav-tabName1">

	<p>This query returns all female patients from the <code>patient</code> table.</p>
<div class="highlight"><pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="cm">/* you can scroll on this tab */</span>
<span class="k">SELECT</span> <span class="o">*</span> 
<span class="k">FROM</span>   <span class="n">kidsfirst</span><span class="p">.</span><span class="n">ga4gh_tables</span><span class="p">.</span><span class="n">patient</span> 
<span class="k">WHERE</span>  <span class="n">Json_extract_scalar</span><span class="p">(</span><span class="n">patient</span><span class="p">,</span> <span class="s1">&#39;$.gender&#39;</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;female&#39;</span> 
<span class="k">LIMIT</span>  <span class="mi">5</span><span class="p">;</span> 
</code></pre></div>

</div>










<div class="tab-pane fade" id="tab12" role="tabpanel" aria-labelledby="nav-tabName2">

	<p>This query returns all conditions observed in female patients from the <code>patient</code> table.</p>
<div class="highlight"><pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="cm">/* you can scroll on this tab */</span>
<span class="k">SELECT</span> <span class="n">Json_extract_scalar</span><span class="p">(</span><span class="n">ncpi_disease</span><span class="p">,</span> <span class="s1">&#39;$.code.text&#39;</span><span class="p">)</span>           <span class="k">AS</span> <span class="n">disease</span><span class="p">,</span> 
       <span class="n">Json_extract_scalar</span><span class="p">(</span><span class="n">ncpi_disease</span><span class="p">,</span> <span class="s1">&#39;$.identifier[0].value&#39;</span><span class="p">)</span> <span class="k">AS</span> <span class="n">identifier</span> 
<span class="k">FROM</span>   <span class="n">kidsfirst</span><span class="p">.</span><span class="n">ga4gh_tables</span><span class="p">.</span><span class="n">ncpi_disease</span> <span class="n">disease</span> 
       <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">kidsfirst</span><span class="p">.</span><span class="n">ga4gh_tables</span><span class="p">.</span><span class="n">patient</span> <span class="n">patient</span> 
               <span class="k">ON</span> <span class="n">patient</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">REPLACE</span><span class="p">(</span><span class="n">Json_extract_scalar</span><span class="p">(</span><span class="n">ncpi_disease</span><span class="p">,</span> 
                                       <span class="s1">&#39;$.subject.reference&#39;</span><span class="p">),</span> 
                               <span class="s1">&#39;Patient/&#39;</span><span class="p">)</span> 
<span class="k">WHERE</span>  <span class="n">Json_extract_scalar</span><span class="p">(</span><span class="n">patient</span><span class="p">,</span> <span class="s1">&#39;$.gender&#39;</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;female&#39;</span> 
<span class="k">LIMIT</span>  <span class="mi">5</span><span class="p">;</span> 
</code></pre></div>

</div>




</div>

</div></p>
<p>
        </div>
    </div>
    





    
    <div class="row">
        <div class="content-area">
            <p class="boxtext"></p>
<h4 id="issuing-queries-using-the-search-api">Issuing queries using the Search API</h4>
<p>Search is a standard REST API. This means Search can be access through standard HTTP calls.</p>
<p>While Search can be navigated using programs like cURL or Postman, it is best accessed programmatically, as every query will return immediately with a next page link that you need to continually &lsquo;poll&rsquo; by fetching the page at the link.</p>
<p>Once you&rsquo;ve visited a page and consumed data from it, you can&rsquo;t go back to it or refresh.</p>
<p>On the right, we provide examples to consume data from the Search API using the GA4GH Commandline Interface, the R client, and cURL.</p>
<blockquote>
<p><a href="../../../../docs/getting-started/intro/doc/">Need help installing client libraries?</a></p>
</blockquote>
<p></p>
        </div>
        <div class="example-area">
            <div class="example">
        
<nav>
	<div class="nav nav-tabs tabs-head" role="tablist">

		
		

		
		
		

		

		<a class="nav-item nav-link content-tab active" id="nav-2" data-toggle="tab" href="#tab21" role="tab"
		   aria-controls="nav-home" aria-selected="true">R</a>

		
		

		
		
		

		

		<a class="nav-item nav-link content-tab" id="nav-2" data-toggle="tab" href="#tab22" role="tab"
		   aria-controls="nav-home" aria-selected="false">Python</a>

		
		

		
		
		

		

		<a class="nav-item nav-link content-tab" id="nav-2" data-toggle="tab" href="#tab23" role="tab"
		   aria-controls="nav-home" aria-selected="false">CLI</a>

		
		

		
		
		

		

		<a class="nav-item nav-link content-tab" id="nav-2" data-toggle="tab" href="#tab24" role="tab"
		   aria-controls="nav-home" aria-selected="false">cURL</a>

		
		

	</div>
</nav>

<div class="tab-content scroll" id="2">









<div class="tab-pane fade show active" id="tab21" role="tabpanel" aria-labelledby="nav-tabName1">

	<p><a href="https://colab.research.google.com/drive/1Y6r1772AW-FWZ1OrOutNoDOvca8Osz3z?usp=sharing">Follow Along in Google Colab</a></p>
<div class="highlight"><pre class="chroma"><code class="language-R" data-lang="R"><span class="c1"># installing devtools</span>
<span class="nf">dir.create</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="nf">Sys.getenv</span><span class="p">(</span><span class="s">&#34;R_LIBS_USER&#34;</span><span class="p">),</span> <span class="n">showWarnings</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">recursive</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;devtools&#34;</span><span class="p">,</span> <span class="n">lib</span> <span class="o">=</span> <span class="nf">Sys.getenv</span><span class="p">(</span><span class="s">&#34;R_LIBS_USER&#34;</span><span class="p">),</span> <span class="n">repos</span> <span class="o">=</span> <span class="s">&#34;https://cran.rstudio.com/&#34;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-R" data-lang="R"><span class="c1"># installing the R client</span>
<span class="n">devtools</span><span class="o">::</span><span class="nf">install_github</span><span class="p">(</span><span class="s">&#34;DNAstack/ga4gh-search-client-r&#34;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-R" data-lang="R"><span class="c1"># Making the request</span>
<span class="nf">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span>
<span class="n">conditionsInFemalePatients</span> <span class="o">&lt;-</span> <span class="n">ga4gh.search</span><span class="o">::</span><span class="nf">ga4gh_search</span><span class="p">(</span><span class="s">&#34;https://search-presto-public.staging.dnastack.com&#34;</span><span class="p">,</span>
  <span class="s">&#34;SELECT Json_extract_scalar(ncpi_disease, &#39;$.code.text&#39;)           AS disease, 
</span><span class="s">          Json_extract_scalar(ncpi_disease, &#39;$.identifier[0].value&#39;) AS identifier 
</span><span class="s">          FROM   kidsfirst.ga4gh_tables.ncpi_disease disease 
</span><span class="s">          INNER JOIN kidsfirst.ga4gh_tables.patient patient 
</span><span class="s">                  ON patient.id = REPLACE(Json_extract_scalar(ncpi_disease, 
</span><span class="s">                                        &#39;$.subject.reference&#39;), 
</span><span class="s">                                  &#39;Patient/&#39;) 
</span><span class="s">WHERE  Json_extract_scalar(patient, &#39;$.gender&#39;) = &#39;female&#39; 
</span><span class="s">LIMIT  5 &#34;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-R" data-lang="R"><span class="c1"># View the results</span>
<span class="nf">print</span><span class="p">(</span><span class="n">conditionsInFemalePatients</span><span class="p">)</span>
</code></pre></div><p>Output:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">                                               disease
<span class="m">1</span>                                       Aortic atresia
<span class="m">2</span>                                       Mitral atresia
<span class="m">3</span>                           Hypoplasia ascending aorta
<span class="m">4</span>                      Hypoplastic left heart syndrome
<span class="m">5</span> Hypoplastic left ventricle <span class="o">(</span>subnormal cavity volume<span class="o">)</span>
                                                                           identifier
<span class="m">1</span>                                       Condition<span class="p">|</span>SD_PREASA7S<span class="p">|</span>272<span class="p">|</span>Aortic atresia<span class="p">|</span>None
<span class="m">2</span>                                       Condition<span class="p">|</span>SD_PREASA7S<span class="p">|</span>272<span class="p">|</span>Mitral atresia<span class="p">|</span>None
<span class="m">3</span>                           Condition<span class="p">|</span>SD_PREASA7S<span class="p">|</span>272<span class="p">|</span>Hypoplasia ascending aorta<span class="p">|</span>None
<span class="m">4</span>                      Condition<span class="p">|</span>SD_PREASA7S<span class="p">|</span>272<span class="p">|</span>Hypoplastic left heart syndrome<span class="p">|</span>None
<span class="m">5</span> Condition<span class="p">|</span>SD_PREASA7S<span class="p">|</span>272<span class="p">|</span>Hypoplastic left ventricle <span class="o">(</span>subnormal cavity volume<span class="o">)</span><span class="p">|</span>None
</code></pre></div>

</div>









<div class="tab-pane fade" id="tab22" role="tabpanel" aria-labelledby="nav-tabName2">

	<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">print</span> <span class="s2">&#34;Not documented, yet&#34;</span>
</code></pre></div>

</div>









<div class="tab-pane fade" id="tab23" role="tabpanel" aria-labelledby="nav-tabName3">

	<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">./dnastack-search query -q <span class="s2">&#34;select json_extract_scalar(ncpi_disease, &#39;</span>$<span class="s2">.code.text&#39;) as disease, json_extract_scalar(ncpi_disease, &#39;</span>$<span class="s2">.identifier[0].value&#39;) as identifier from kidsfirst.ga4gh_tables.ncpi_disease disease INNER JOIN kidsfirst.ga4gh_tables.patient patient ON patient.id=replace(json_extract_scalar(ncpi_disease, &#39;</span>$<span class="s2">.subject.reference&#39;), &#39;Patient/&#39;) WHERE json_extract_scalar(patient, &#39;</span>$<span class="s2">.gender&#39;)=&#39;female&#39; limit 5&#34;</span>
</code></pre></div>

</div>









<div class="tab-pane fade" id="tab24" role="tabpanel" aria-labelledby="nav-tabName4">

	<p>These requests
This query returns all female patients from the <code>patient</code> table.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">curl --request POST <span class="se">\
</span><span class="se"></span>  --url https://search-presto-public.staging.dnastack.com/search <span class="se">\
</span><span class="se"></span>  --header <span class="s1">&#39;content-type: application/json&#39;</span> <span class="se">\
</span><span class="se"></span>  --data <span class="s1">&#39;{ &#34;query&#34;: &#34;select * from kidsfirst.ga4gh_tables.patient WHERE json_extract_scalar(patient, &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;$.gender&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;)=&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;female&#39;</span><span class="se">\&#39;</span><span class="s1">&#39; limit 5&#34;}&#39;</span>
</code></pre></div><p>This query returns all conditions observed in female patients from the <code>patient</code> table.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">curl --request POST <span class="se">\
</span><span class="se"></span>  --url https://search-presto-public.staging.dnastack.com/search <span class="se">\
</span><span class="se"></span>  --header <span class="s1">&#39;content-type: application/json&#39;</span> <span class="se">\
</span><span class="se"></span>  --data <span class="s1">&#39;{ &#34;query&#34;: &#34;select json_extract_scalar(ncpi_disease, &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;$.code.text&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;) as disease, json_extract_scalar(ncpi_disease, &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;$.identifier[0].value&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;) as identifier from kidsfirst.ga4gh_tables.ncpi_disease disease INNER JOIN kidsfirst.ga4gh_tables.patient patient ON patient.id=replace(json_extract_scalar(ncpi_disease, &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;$.subject.reference&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;), &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;Patient/&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;) WHERE json_extract_scalar(patient, &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;$.gender&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;)=&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;female&#39;</span><span class="se">\&#39;</span><span class="s1">&#39; limit 5&#34;}&#39;</span>
</code></pre></div>

</div>




</div>

</div></p>
        </div>
    </div>
    

</div>


        
        </div><script src="../../../../js/jquery-3.5.1.min.js"></script>
<script src="../../../../js/bootstrap.min.js"></script>
<script src="https://unpkg.com/lunr/lunr.js"></script>
<script>
    document.getElementById("scrollto").scrollIntoView(true);
</script>
<script type="text/javascript">


var idx, searchInput, searchResults = null
var documents = []

function renderSearchResults(results){

    if (results.length > 0) {

        
        if (results.length > 9){
            results = results.slice(0,10)
        }

        
        searchResults.innerHTML = ''

        
        results.forEach(result => {
        
            
            var article = document.createElement('article')
            var uri = result.ref.replace("/index.json","")
            article.innerHTML = `
            <a href="${uri}" class="search-result-item"><p class="search-result-title">${documents[result.ref].title}</p> <i class="icon-external-link"></i></a>
            `
            searchResults.appendChild(article)
        })

    // if results are empty
    } else {
        searchResults.innerHTML = '<p>No results found.</p>'
    }
}

function registerSearchHandler() {

    
    searchInput.oninput = function(event) {

        
        if (searchInput.value == '') {
            
            searchResults.innerHTML = ''
        } else {
            
            
            var query = event.target.value

            
            var results = idx.search(query + '*')

            
            renderSearchResults(results)
        }
    }

    
    searchInput.focus()
    searchInput.placeholder = ''
}

$('#search-input-modal').on('shown.bs.modal', function () {
  $('#search-input').trigger('focus')
})

window.onload = function() {

    
    searchInput = document.getElementById('search-input')
    searchResults = document.getElementById('search-results')

    
    fetch('/ga4gh-search-docs/docs/index.json', {
        method: 'get'
    }).then(
        res => res.json()
    ).then(
        res => {

            
            idx = lunr(function() {
                this.ref('url')
                this.field('title')
                this.field('content')

                res.forEach(function(doc) {
                    this.add(doc)
                    documents[doc.url] = {
                        'title': doc.title,
                        'content': doc.content,
                    }
                }, this)
            })

            
            registerSearchHandler()
        }
    ).catch(
        err => {
            searchResults.innerHTML = `<p>${err}</p>`
        }
    )
}
</script>

</body>
</html>
